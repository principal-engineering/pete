CREATE OR REPLACE PACKAGE ut_petet_input_argument AS

    description pete_core.typ_description := 'Input Argument Type';

    PROCEDURE after_each;

    PROCEDURE ctor(d VARCHAR2 := 'minimal constructor works');
    PROCEDURE ctor_without_mandatory(d VARCHAR2 := 'constructor without mandatory attributes fails');
    PROCEDURE copy(d VARCHAR2 := 'copy works');
    PROCEDURE equals(d VARCHAR2 := 'equals works');

END;
/
CREATE OR REPLACE PACKAGE BODY ut_petet_input_argument AS

    g_xml1 xmltype := xmltype.createxml('<foo>foo</foo>');
    g_xml2 xmltype := xmltype.createxml('<bar>bar</bar>');

    --------------------------------------------------------------------------------
    PROCEDURE ctor(d VARCHAR2) IS
        l_name        VARCHAR2(255) := 'ctor';
        l_input_argument petet_input_argument;
    BEGIN
        --log
        pete_logger.log_method_description(d);
        --test
        --with anonymous input_argument
        l_input_argument := petet_input_argument(NAME            => l_name);
        pete_configuration_runner_api.set_input_argument(a_input_argument_io => l_input_argument);
        --assert
        pete_assert.pass;
    END;

    --------------------------------------------------------------------------------
    PROCEDURE ctor_without_mandatory(d VARCHAR2) IS
        l_thrown      BOOLEAN := FALSE;
        l_input_argument petet_input_argument;
    BEGIN
        --log
        pete_logger.log_method_description(d);
        --test
        BEGIN
            l_input_argument := petet_input_argument(NAME => NULL);
            l_thrown      := FALSE;
        EXCEPTION
            WHEN OTHERS THEN
                l_thrown := TRUE;
        END;
        --assert
        IF NOT l_thrown
        THEN
            raise_application_error(-20000,
                                    'PETET_input_argument constructor should have thrown.');
        END IF;
    END;

    --------------------------------------------------------------------------------
    PROCEDURE copy(d VARCHAR2) IS
        l_src petet_input_argument;
        l_tgt petet_input_argument;
    BEGIN
        --log
        pete_logger.log_method_description(d);
        --test
        l_src := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, DESCRIPTION => 'd');
        l_tgt := l_src.copy();
        --assert
        pete_assert.eq(l_src.id, l_tgt.id);
        pete_assert.eq(l_src.name, l_tgt.name);
        pete_assert.eq(l_src.value, l_tgt.value);
        pete_assert.eq(l_src.description, l_tgt.description);
        --test
        l_src := petet_input_argument(NAME => 'n', value => g_xml1, DESCRIPTION => 'd');
        l_tgt := l_src.copy();
        --assert
        pete_assert.eq(l_src.id, l_tgt.id);
        pete_assert.eq(l_src.name, l_tgt.name);
        pete_assert.eq(l_src.value, l_tgt.value);
        pete_assert.eq(l_src.description, l_tgt.description);
        --test
        l_src := petet_input_argument(id => 1, NAME => 'n', DESCRIPTION => 'd');
        l_tgt := l_src.copy();
        --assert
        pete_assert.eq(l_src.id, l_tgt.id);
        pete_assert.eq(l_src.name, l_tgt.name);
        pete_assert.eq(l_src.value, l_tgt.value);
        pete_assert.eq(l_src.description, l_tgt.description);
        --test
        l_src := petet_input_argument(id => 1, NAME => 'n', value => g_xml1);
        l_tgt := l_src.copy();
        --assert
        pete_assert.eq(l_src.id, l_tgt.id);
        pete_assert.eq(l_src.name, l_tgt.name);
        pete_assert.eq(l_src.value, l_tgt.value);
        pete_assert.eq(l_src.description, l_tgt.description);
    END;

    --------------------------------------------------------------------------------
    PROCEDURE equals(d VARCHAR2) IS
        l_input_argument1 petet_input_argument;
        l_input_argument2 petet_input_argument;
    BEGIN
        --log
        pete_logger.log_method_description(d);
        --prepare
        l_input_argument1 := petet_input_argument(NAME => 'n');
        l_input_argument2 := petet_input_argument(NAME => 'n');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_YES,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_YES,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'x');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'n', value => g_xml2, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'x', value => g_xml1, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 2, NAME => 'n', value => g_xml1, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(NAME => 'n', value => g_xml1, description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'n', description => 'd');
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
        --prepare
        l_input_argument1 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1, description => 'd');
        l_input_argument2 := petet_input_argument(id => 1, NAME => 'n', value => g_xml1);
        --assert
        pete_assert.eq(a_expected_in => pete_core.g_NO,
                       a_actual_in   => l_input_argument1.equals(l_input_argument2));
    END;

    --------------------------------------------------------------------------------
    procedure after_each is
    begin
        rollback;
    end;

END;
/
